const { v4: uuidv4 } = require("uuid");
const db = require("../models");
const { generateMap, randInt } = require("../tools/game/lib");
const items = require("../tools/game/data/items");
const GameDB = db.game;
const UserDB = db.user;

const gameObject = {
  map: [],
  players: [],
  generateNewMapCount: 0,
};

// Create and Save a new Game
exports.create = async (req, res) => {
  /*
  const { new_map, gen_player } = generateMap(20, 20, [], 40, 6, items);
  console.log(1, new_map);
  console.log(2, gen_player);
  */
  const passId = req.body.passId;
  const game = new GameDB({
    name: "",
    code: uuidv4(),
    map: [
      [
        {
          name: "Ground",
          x: 0,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 0,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 12,
          y: 0,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 17,
          y: 0,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 0,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 6,
          y: 1,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 1,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Obstacle",
          x: 0,
          y: 2,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 7,
          y: 2,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 12,
          y: 2,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 13,
          y: 2,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 2,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 3,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 14,
          y: 3,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 15,
          y: 3,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 3,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 4,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 5,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 16,
          y: 5,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 5,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 3,
          y: 6,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 6,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Obstacle",
          x: 0,
          y: 7,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 7,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 19,
          y: 7,
          obstacle: true,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 8,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 9,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 11,
          y: 9,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 12,
          y: 9,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 9,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 1,
          y: 10,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 10,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 1,
          y: 11,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 6,
          y: 11,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 11,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 13,
          y: 11,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 11,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Player",
          x: 0,
          y: 12,
          obstacle: false,
          view_distance: null,
          id: 2,
          obj: {
            _id: "161133777986898",
            name: "toto_3",
            img: "/public/img/icons/zorfiL.gif",
            dead: false,
            items: [],
            numPlayer: 2,
            stat: {
              health: 40,
              damage: 4,
              move: 3,
            },
          },
        },
        {
          name: "Ground",
          x: 1,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 3,
          y: 12,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 12,
          y: 12,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 13,
          y: 12,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Item",
          x: 14,
          y: 12,
          obstacle: false,
          view_distance: null,
          obj: {
            name: "Umbrella",
            icon: "🌂",
            stat: {
              damage: 6,
              move: 2,
            },
          },
        },
        {
          name: "Ground",
          x: 15,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 12,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Item",
          x: 3,
          y: 13,
          obstacle: false,
          view_distance: null,
          obj: {
            name: "Star",
            icon: "💫",
            stat: {
              damage: 10,
              move: 0,
            },
          },
        },
        {
          name: "Obstacle",
          x: 4,
          y: 13,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 11,
          y: 13,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 13,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 19,
          y: 13,
          obstacle: true,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 3,
          y: 14,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 5,
          y: 14,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 9,
          y: 14,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 14,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Player",
          x: 9,
          y: 15,
          obstacle: false,
          view_distance: null,
          id: 0,
          obj: {
            _id: "16113377798684",
            name: "toto_1",
            img: "/public/img/icons/zorfiL.gif",
            dead: false,
            items: [],
            numPlayer: 0,
            stat: {
              health: 40,
              damage: 4,
              move: 3,
            },
          },
        },
        {
          name: "Ground",
          x: 10,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Player",
          x: 11,
          y: 15,
          obstacle: false,
          view_distance: null,
          id: 1,
          obj: {
            _id: "161133777986890",
            name: "toto_2",
            img: "/public/img/icons/zorfiL.gif",
            dead: false,
            items: [],
            numPlayer: 1,
            stat: {
              health: 40,
              damage: 4,
              move: 3,
            },
          },
        },
        {
          name: "Ground",
          x: 12,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Item",
          x: 15,
          y: 15,
          obstacle: false,
          view_distance: null,
          obj: {
            name: "Star",
            icon: "💫",
            stat: {
              damage: 10,
              move: 0,
            },
          },
        },
        {
          name: "Ground",
          x: 16,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 15,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 3,
          y: 16,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 16,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 18,
          y: 16,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 19,
          y: 16,
          obstacle: true,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 17,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 1,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 8,
          y: 18,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 13,
          y: 18,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Item",
          x: 17,
          y: 18,
          obstacle: false,
          view_distance: null,
          obj: {
            name: "Umbrella",
            icon: "🌂",
            stat: {
              damage: 6,
              move: 2,
            },
          },
        },
        {
          name: "Ground",
          x: 18,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 18,
          obstacle: false,
          view_distance: null,
        },
      ],
      [
        {
          name: "Ground",
          x: 0,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Obstacle",
          x: 1,
          y: 19,
          obstacle: true,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 2,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 3,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 4,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 5,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 6,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 7,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 8,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 9,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 10,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 11,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 12,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 13,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 14,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 15,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 16,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 17,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 18,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
        {
          name: "Ground",
          x: 19,
          y: 19,
          obstacle: false,
          view_distance: null,
        },
      ],
    ],
    actions: [],
    players: [],
    owner: "",
    status: "creating-new-game",
  });

  const curentUser = {
    username: "",
    passId: "",
  };

  // Find User in the database
  const findUser = await UserDB.findOne({ passId: passId }, "-passId")
    .then(async (data) => {
      if (!data) {
        res.status(404).send({ message: "Not found user..." });
      } else {
        // console.log(1, curentUser);
        curentUser.passId = req.body.passId;
        curentUser.username = data.username;
        // console.log(2, curentUser);

        game.name = "game of " + data.username;
        game.players = curentUser;

        //console.log(3, new_map);
        //gameObject.map = new_map;
        //gameObject.players = gen_player;
        gameObject.map = game.map;
        gameObject.players.push(curentUser);
        gameObject.generateNewMapCount++;

        game.owner = req.body.passId;

        // Save Game in the database
        if (game.name || game.code || game.owner || game.status) {
          return await game
            .save(game)
            .then((data) => res.send(data))
            .catch((err) => {
              res.status(500).send({
                message:
                  err.message || "Some error occurred while creating the Game.",
              });
            });
        }
        res.status(500).send({ message: "Data is incomplete!" });
      }
      res.status(400).send({ message: "Error server..." });
    })
    .catch((error) => {
      res.status(500).send({ message: error.message || "Error server..." });
    });

  // Create a Game
  if (!passId) res.status(404).send({ message: "Not found user..." });
  return findUser;
};

// Find a single Game with a code
exports.findByCode = (req, res, sendData) => {
  const code = req.body.code;
  // No validation because it's a GET request
  GameDB.findOne({ code: code })
    .then((data) => {
      if (!data) res.status(404).send({ message: "Not found game..." });
      else return sendData ? res.send(data) : data;
    })
    .catch((_) => {
      res.status(500).send({ message: "Error server..." });
    });
};

// Update a Game id in the request
exports.update = async (req, res) => {
  const { passIdCurentUser, code, name } = req.body;
  const game = {
    name: "",
    code: "",
    map: [],
    actions: [],
    players: [],
    owner: "",
    status: "game-launched",
  };

  const curentUser = {
    username: "",
    passId: "",
  };

  // Find User in the database
  const findUser = await UserDB.findOne({ passId: passIdCurentUser }, "-passId")
    .then(async (data) => {
      if (!data) {
        res.status(404).send({ message: "Not found user..." });
      } else {
        // console.log(1, curentUser);
        curentUser.passId = passIdCurentUser;
        curentUser.username = data.username;
        // console.log(2, curentUser);
        // Find a single Game with a code
        return await GameDB.findOne({ code: code })
          .then(async (data) => {
            if (!data) {
              res.status(404).send({ message: "Not found game..." });
            } else {
              if (passIdCurentUser === data.owner) {
                game.name = name;
                game.code = data.code;
                game.map = gameObject.map;
                game.actions = data.actions;
                game.players = gameObject.players;
                game.owner = data.owner;
                // Update name, status and map of this Game in the database if it is the owner
                return await GameDB.updateOne(game)
                  .then(async () => {
                    // Again find a single Game with a code because the result of update request return status code but not data
                    return await GameDB.findOne({ code: code })
                      .then((data) => res.send(data))
                      .catch((_) => {
                        res.status(500).send({ message: "Error server..." });
                      });
                  })
                  .catch((err) => {
                    res.status(500).send({
                      message:
                        err.message ||
                        "Some error occurred while update the Game.",
                    });
                  });
              } else {
                if (
                  gameObject.players.length > 0 &&
                  gameObject.players.length < 6
                ) {
                  let filterPlayers = gameObject.players.filter(
                    (player) => player.username == curentUser.username
                  );
                  if (filterPlayers.length === 0) {
                    gameObject.players.push(curentUser);
                  }
                }
                game.name = data.name;
                game.code = data.code;
                game.map = data.map;
                game.actions = data.actions;
                game.players = gameObject.players;
                game.owner = data.owner;
                game.status = data.status;
                gameObject.players = game.players;
                // Update player of this Game in the database if it is not the owner
                return await GameDB.updateOne(game)
                  .then(async () => {
                    // Again find a single Game with a code because the result of update request return status code but not data
                    return await GameDB.findOne({ code: code })
                      .then((data) => res.send(data))
                      .catch((_) => {
                        res.status(500).send({ message: "Error server..." });
                      });
                  })
                  .catch((err) => {
                    res.status(500).send({
                      message:
                        err.message ||
                        "Some error occurred while update the Game.",
                    });
                  });
              }
            }
          })
          .catch((_) => {
            res.status(500).send({ message: "Error server..." });
          });
      }
      res.status(400).send({ message: "Error server..." });
    })
    .catch((error) => {
      res.status(500).send({ message: error.message || "Error server..." });
    });

  // Update a Game
  if (!passIdCurentUser) res.status(404).send({ message: "Not found user..." });
  return findUser;
};
